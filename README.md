**Предложение по организации инфраструктуры API Gateway**

Для обеспечения эффективной реализации API Gateway в микросервисной архитектуре предлагаем рассмотреть следующие программные решения:

1. **Kong**
2. **NGINX**
3. **AWS API Gateway**
4. **Tyk**
5. **Apigee**

Ниже представлена сравнительная таблица ключевых возможностей этих решений:

| **Характеристика**               | **Kong**                      | **NGINX**                     | **AWS API Gateway**           | **Tyk**                        | **Apigee**                     |
|----------------------------------|-------------------------------|-------------------------------|-------------------------------|--------------------------------|--------------------------------|
| **Маршрутизация запросов**       | Поддержка гибкой маршрутизации на основе конфигурации | Высокопроизводительная маршрутизация с конфигурационными файлами | Интегрированная маршрутизация через консоль AWS | Гибкая маршрутизация с поддержкой плагинов | Расширенная маршрутизация с политиками |
| **Проверка аутентификации**      | Поддержка OAuth2, JWT, ключей API и других плагинов аутентификации | Требует ручной настройки и интеграции с дополнительными модулями | Встроенная поддержка аутентификации через IAM, Cognito и другие | Встроенная поддержка OAuth2, JWT и других методов | Расширенные возможности аутентификации и авторизации |
| **Терминация HTTPS**             | Поддержка SSL/TLS с возможностью управления сертификатами | Полная поддержка SSL/TLS с настройкой через конфигурационные файлы | Встроенная терминация SSL с автоматическим управлением сертификатами | Поддержка SSL/TLS и управление сертификатами | Высокая безопасность с управлением SSL/TLS сертификатами |
| **Масштабируемость**             | Высокая масштабируемость через кластеризацию | Высокая производительность и масштабируемость | Автоматическая масштабируемость в рамках AWS | Масштабируемость через горизонтальное масштабирование | Высокая масштабируемость в облачной среде |
| **Поддержка плагинов и расширений** | Широкий выбор плагинов через экосистему Kong | Ограниченная поддержка через модули и скрипты | Ограниченные возможности через интеграции AWS | Богатая поддержка плагинов и расширений | Расширяемость через платформенные интеграции |
| **Управление и мониторинг**      | Интегрированные инструменты управления и мониторинга | Требует сторонних решений для мониторинга | Интеграция с AWS CloudWatch и другими сервисами | Встроенные инструменты мониторинга и аналитики | Расширенные инструменты аналитики и мониторинга |
| **Стоимость**                    | Open Source с платными Enterprise версиями | Open Source, коммерческие версии NGINX Plus | Ценообразование по использованию AWS | Open Source с платными версиями | Коммерческое решение с различными тарифами |

**Выбор решения: Kong**

**Обоснование выбора:**

1. **Маршрутизация запросов:** Kong предоставляет гибкую и мощную маршрутизацию запросов на основе конфигурации, что позволяет легко направлять трафик к нужным сервисам в микросервисной архитектуре.

2. **Проверка аутентификации:** Поддержка множества методов аутентификации, включая OAuth2, JWT и ключи API, позволяет обеспечить надежную безопасность API. Дополнительно, наличие большого количества плагинов упрощает интеграцию с существующими системами аутентификации.

3. **Терминация HTTPS:** Kong полностью поддерживает терминацию HTTPS с возможностью управления сертификатами SSL/TLS, что отвечает требованию обеспечения безопасности каналов связи.

4. **Масштабируемость и производительность:** Kong обладает высокой масштабируемостью благодаря кластеризации и обладает высокой производительностью, что важно для крупной компании с большим количеством запросов.

5. **Расширяемость и поддержка:** Широкий выбор плагинов и активное сообщество обеспечивают гибкость и возможность расширения функционала API Gateway по мере необходимости.

6. **Управление и мониторинг:** Интегрированные инструменты управления и мониторинга в Kong позволяют эффективно отслеживать состояние системы и оперативно реагировать на возникающие проблемы.

7. **Стоимость:** Open Source версия Kong предоставляет все необходимые базовые функции без дополнительных затрат, а при необходимости можно перейти на Enterprise версию для получения расширенных возможностей и поддержки.

Таким образом, Kong является наиболее подходящим решением для обеспечения требований по маршрутизации, аутентификации и терминации HTTPS в микросервисной архитектуре крупной компании.

## Задача 3
[Задание](https://github.com/netology-code/devkub-homeworks/tree/main/11-microservices-02-principles)
### Проделанная работа:
1. Обновил версии Python пакетов в [requirements.txt](task3/security/requirements.txt) security
2. Обновил версии образов в [docker-compose.yml](task3/compose.yml)
3. Переписал `endpoint` для `createbucket`, т.к. в новой версии были существенные изменения, без которых сборка не работала:  
```yml
entrypoint: >
      /bin/sh -c "
      /usr/bin/mc alias set storage http://storage:9000 ${Storage_AccessKey} ${Storage_Secret} &&
      /usr/bin/mc mb --ignore-existing storage/${Storage_Bucket} &&
      /usr/bin/mc anonymous set public storage/${Storage_Bucket} &&
      echo 'Бакет и политика доступа успешно настроены.' &&
      exit 0
      "
```
4. Написал [`nginx.conf`](task3/gateway/nginx.conf)
### Проверка работоспособности:
Регистрация пользователя:  

`curl -X POST -H 'Content-Type: application/json' -d '{"login":"bob", "password":"qwe123"}' http://localhost/token`

![login](images/image01.png)

Загрузка файла:

`curl -X POST -H 'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJib2IifQ.hiMVLmssoTsy1MqbmIoviDeFPvo-nCd92d4UFiN2O2I' -H 'Content-Type: octet/stream' --data-binary @1.png http://localhost/upload`

![upload](images/image02.png)

Скачивание файла:

curl http://localhost/images/79bfb912-7ca8-42c7-8b50-b8cda0f3c870.png > 2.png

![download](images/image03.png)

Проверка корректности файла по размеру:

`ls -la *.png`

![ls](images/image04.png)

